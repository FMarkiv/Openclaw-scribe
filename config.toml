# ZeroClaw + Openclaw-Scribe Configuration
# ──────────────────────────────────────────
#
# This file configures the ZeroClaw agent with Openclaw-Scribe extensions.
# Copy this file to ~/.zeroclaw/config.toml and customize.

# ── Provider ─────────────────────────────────────────────────────
[provider]
# primary = "anthropic"  # anthropic | openai | ollama | openrouter | compatible
# api_key = "sk-..."     # Or set ANTHROPIC_API_KEY / OPENAI_API_KEY env var
# model = "claude-sonnet-4-20250514"

# ── Fallback Providers ──────────────────────────────────────────
#
# Optional ordered list of fallback providers. When the primary
# provider fails with a retryable error (429, 500, 502, 503, 529,
# or connection timeout), ZeroClaw automatically tries the next
# fallback in sequence. On the next user turn, the primary is
# always tried first again.
#
# Auth errors (401, 403) skip the provider. Context overflow errors
# trigger compaction instead of failover.
#
# Use /provider to check the current provider status and chain.
#
# [[provider.fallbacks]]
# provider = "openai"
# model = "gpt-4o"
#
# [[provider.fallbacks]]
# provider = "openrouter"
# model = "anthropic/claude-sonnet-4-20250514"

# ── Workspace ────────────────────────────────────────────────────
[workspace]
# root = "."             # Path to workspace root (contains SOUL.md, MEMORY.md, etc.)

# ── Web Search ───────────────────────────────────────────────────
# brave_api_key = ""     # Or set BRAVE_API_KEY env var

# ── Web Fetch Safety Limits ──────────────────────────────────────
#
# Controls for the web_fetch tool to prevent oversized downloads,
# runaway redirects, and accidental binary fetches.
#
# [web]
# max_fetch_bytes = 5242880    # Max response body (default: 5 MB)
# max_redirects = 5            # Max redirect hops (default: 5)
# fetch_timeout_secs = 30      # Total request timeout (default: 30s)

# ── Telegram Bot ─────────────────────────────────────────────────
#
# Enable a Telegram bot channel that runs alongside the CLI.
# The bot uses HTTP long-polling (no public IP or webhooks needed).
#
# To set up:
# 1. Message @BotFather on Telegram and create a bot
# 2. Copy the bot token below (or set TELEGRAM_BOT_TOKEN env var)
# 3. Set enabled = true (or pass --telegram on the CLI)
# 4. Start ZeroClaw — the bot will begin polling for messages
#
# The Telegram listener shares the same agent, memory, tools, and
# session persistence as the CLI. Both can run simultaneously.
#
[telegram]
# bot_token = "123456789:AAF-your-bot-token-here"
# enabled = false

# Polling interval in seconds. Lower = more responsive, higher = less CPU.
# Default: 5 seconds. Minimum: 1 second.
poll_interval_secs = 5

# Long-polling timeout in seconds. Telegram holds the connection open
# for this long before returning an empty response. Higher values reduce
# the number of HTTP requests. Default: 30 seconds.
long_poll_timeout_secs = 30

# ── Sandbox ─────────────────────────────────────────────────────
#
# Optional Docker sandboxing for shell command execution. When
# enabled, shell commands run inside an ephemeral Docker container
# instead of directly on the host — useful for untrusted inputs
# (e.g. Telegram users).
#
# Requires Docker to be installed. When disabled (the default),
# shell commands run directly on the host with zero overhead.
#
# [sandbox]
# enabled = false                    # opt-in, default off
# image = "zeroclaw-sandbox:latest"  # Docker image to use
# workspace = "/workspace"           # mount point inside container
# timeout_seconds = 30               # per-command timeout
# memory_limit = "256m"              # container memory cap
# network = false                    # disable network in sandbox
# mount_paths = []                   # additional read-only mounts

# ── Memory Growth Controls ─────────────────────────────────────────
#
# Controls how MEMORY.md grows over time. Prevents unbounded growth
# through size caps, topic splitting, compaction, and stale entry
# archival.
#
[memory]
# Maximum size per section in KB. Oldest entries are dropped when exceeded.
section_max_kb = 2

# Total MEMORY.md size in KB before splitting into topic files.
total_max_kb = 16

# Compaction triggers at this percentage of total_max_kb (default: 75% = 12KB).
compact_threshold_pct = 75

# Entries not referenced in this many days are candidates for archival.
stale_days = 30

# Enable LLM-based semantic search as Phase 2 of memory_recall (default: true).
# When enabled, keyword grep results are sent to the LLM for relevance scoring.
# Only entries scoring 7+/10 are returned, ordered by score.
# Note: scoring calls count toward normal API usage/billing.
semantic_search = true

# Model to use for semantic scoring (default: "" = use primary model).
# Set to a cheaper/faster model to reduce costs for scoring calls.
# Example: "claude-haiku-3" for Anthropic, "gpt-4o-mini" for OpenAI.
scoring_model = ""

# ── Structured Logging ─────────────────────────────────────────────
#
# Structured JSON logging writes one JSON object per line to a daily
# log file at log_dir/YYYY-MM-DD.jsonl.  Human-readable stderr output
# continues unchanged — this is purely additive.
#
# Each event includes: timestamp, loop_id, turn_number, event_type,
# provider, model, duration_ms, token counts, tool_name, detail, level.
#
# Log files older than retain_days are deleted on startup (best-effort).
#
# Use /logs to query structured logs:
#   /logs              — last 20 entries
#   /logs 50           — last 50 entries
#   /logs 20 error     — last 20 error events
#   /logs failover     — last 20 failover events
#
[logging]
structured = true
log_dir = "~/.zeroclaw/logs"
retain_days = 14

# ── Agent Loop ────────────────────────────────────────────────────
#
# Controls recursion and loop detection in the agent tool-call loop.
# The guard detects identical repeated calls, oscillation patterns
# (A→B→A→B), and memory_store spam.  On detection it injects a
# warning; if the agent still repeats, the loop is force-stopped.
#
# max_compaction_depth controls how many successive summarize-the-summary
# compactions are allowed before triggering a full rebuild from primary
# sources (daily notes + MEMORY.md). Default: 3.
#
# [agent]
# max_identical_tool_calls = 3   # Warn after N identical calls
# max_oscillation_depth = 4      # Window for A→B→A→B detection
# max_compaction_depth = 3       # Rebuild from sources after N compactions

# ── Security ─────────────────────────────────────────────────────
# [security]
# shell_allowlist = ["git", "cargo", "npm", "ls", "cat", "grep"]
# readonly = false

# ── Model Context Windows ────────────────────────────────────────
#
# Override known model context window sizes (in tokens). The
# ContextMeter uses these to calculate usage percentages and
# estimate remaining turns. Models not listed here fall back
# to the built-in table; unknown models default to 128000.
#
# [models]
# "claude-opus-4-6" = 200000
# "claude-opus-4-6-extended" = 1000000
# "claude-sonnet-4-6" = 200000
# "gpt-5.2" = 400000
# "gpt-5.2-chat" = 128000
# "gemini-3-pro" = 1000000
# "gemini-3-flash" = 1000000

# ── Browser ──────────────────────────────────────────────────────
# [browser]
# domain_allowlist = []

# ── Composio ─────────────────────────────────────────────────────
#
# Composio integration for connecting to external apps (Gmail,
# Google Calendar, GitHub, Notion, etc.) via OAuth. Composio handles
# OAuth flows and provides a unified API for 250+ apps.
#
# To set up:
# 1. Create an account at https://composio.dev
# 2. Get your API key from the dashboard
# 3. Set enabled = true and add your API key below (or set COMPOSIO_API_KEY env var)
# 4. Use /connect <app> to connect apps (e.g. /connect gmail)
#
# Commands:
#   /connect <app>         — Start OAuth flow, show authorization URL
#   /connect-check <app>   — Verify if app is connected
#   /connections           — List all connected apps
#   /disconnect <app>      — Remove app connection
#   /composio-actions <app> — List available actions for an app
#
# [composio]
# enabled = false
# api_key = ""                                    # Or set COMPOSIO_API_KEY env var
# base_url = "https://backend.composio.dev/api/v2"
